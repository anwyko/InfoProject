<!DOCTYPE html>
<html>
  <head>
    <!-- HEADER AND FOOTER TEMPLATE (DO NOT EDIT - JUST COPY AND PASTE)-->
    <base target="_top">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <meta name='color-scheme' content='light'>

    <style>
      * {
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
      }

      html {
        max-width: 100vw;
      }

      body {
        //border: solid yellow;
        display: flex;
        flex-direction: column;
        //position: relative;
        justify-content: space-between;
        height: 100vh;
        //margin-bottom: 30px;
        overflow-x: hidden;
        //max-width: 100%;
      }

      footer {
        text-align: center;
        font-size: 0.85em;
        color: white;
        background-color: black;
        box-shadow: 0px 0 10px rgba(0, 0, 0, 0.7);
        margin-top: 30px;
        width: 100%;
        //position: relative;
        //height: 10%;
      }

      nav {
        height:100%
        position: sticky;
        top: 0;
      }

      nav ul li:hover {
        background-color: grey;
      }

      .brand-logo, .brand-logo img {
          
          height: 100%;
      }

      .nav-wrapper {
        height: 100%;
        background-color: black;
      }

      #cartIcon {
        position: relative;
        left: 10px;
      }

      #cartIconNav {
        position: relative;
        margin-right: 5px;
      }

      main {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;        
        //border: solid black;
       // position: relative;
        min-height: max-content;
        //height: 100%;
        overflow-x:hidden;
        max-width: 100%;
      }

      #head {
        //border: solid red;

      }

      h4 {
        margin-bottom: 30px;
      }

      tr, td, th {
        text-align: center;
        max-width: 100%;
        
      }

      tr, tfoot {
        //overflow-x: scroll;
      }


      @media screen and (max-width: 600px) {
        td{
          font-size: 2.5vw;
        } 
      }

      .nowrap {
        white-space: nowrap;
      }      

      tfoot {
        font-weight: bold;
       font-size: 1.2em;
      }

      #bn, #bn2 {
        //margin-top: 50px;
        margin-left: auto;
        margin-right: auto;
        background-color: black;
        width: 40%;
      }

      @media screen and (min-width: 600px) {
        #bn {
          width: 20%;
        } 
      }

      table {
        display: block;
        //position: relative;
        max-height: 100%;
        //max-width: 100%;
        //border: solid red;
        margin-bottom: 30px;
        //overflow-x: scroll;
        table-layout: fixed;
        //max-width: none;
        width: 100%;
        min-width: 100%;
      }

      .qty:focus, .qty {
        border: none;
        background-color: transparent;
        //vertical-align: middle;
      }

      .adjust, .adjust:focus {
        margin: 0;
        border: none;
        padding:0; 
        background-color: transparent;
        //font-size: 2em;
        vertical-align: middle;
        /* padding-bottom: 4px;
        padding-left: -2px;
        padding-right: -2px; */
        //width: 5px;
      }

      .adjust:active {
          color: gray;
      }

      #labeltop {
			font-size: 3rem;
			font-family: Impact, Charcoal, sans-serif;
			text-align: center;
		}

    .mod {
      position: fixed;
      border: solid black;
      border-radius: 10px;
      background-color: white;
      width: fit-content;
      height: fit-content;
      max-width: 40vw;
      min-width: 250px;
      top:50%; 
      transform:translateY(-50%);
      align-self: center;
      z-index: 5;
      opacity: 1;
      box-shadow: 0px 0px 11px -2px rgba(0,0,0,0.7);
    }

    @media screen and (max-width: 750px) {
        .mod {
          max-width: 70vw;
        } 
      }

    .back {
      position: fixed;
      width: 100vw;
      height: 100vh;
      background-color: gray;
      opacity: 0.1;
      z-index: 4;
    }
     

    //***YOUR CSS GOES HERE***//

    </style>
  </head>

  <body>
    <div id="sec">
    <header>
      <div class="navbar-fixed">
            <nav>
            <div class="nav-wrapper">
              <a href="<?= ScriptApp.getService().getUrl(); ?>?v=index" class="brand-logo"><img id="logo" 
              src="https://i.imgur.com/WkcY6XS.png"></a>
              <a href="" data-target="items" class="sidenav-trigger"><i class="material-icons">menu</i></a>
              <ul class="right hide-on-med-and-down">
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
                <li id="cart"></li>
              </ul>
            </div>
          </nav>
      </div>

          <ul class="sidenav" id="items">
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
            <li id="navCart"></li>
          </ul>
    </header>

    <!-- YOUR HTML GOES HERE, BUT ADJUST GRID LAYOUT CSS FOR THE BODY ELEMENT TO MATCH THE NUMBER OF ROWS/COLUMNS ELEMENTS IN BODY -->

    <main id="main">




    <h4  style="text-align:center;">Order Summary</h4>

    <table>
           <thead>
                <tr>
                   <th>#</th>
                   <th>Quantity</th>
                   <th>Desired Device</th>
                   <th>Traded Device</th>
                   <th>Storage</th>
                   <th>Colour</th>
                   <th>Price</th>
                </tr>
                </thead>
                  <tbody id="summary">
                                                
                  </tbody>
                  <tfoot id="total">

                  </tfoot>
           </table>
    <button onclick="openForm()" id="bn" style="visibility: hidden" class="waves-effect waves-light black btn-small">Checkout</button>
    <br>

    <button style="display: none" id="bn2" onclick="show()" class="waves-effect waves-light black btn-small">Modal</button>
    <br>  

        <div style="display: none" class="" >
        </div>

        <div style="padding: 10px; style=visibility: hidden; display: none; flex-direction: column" class="">
              <h5 style="text-align: center">Confirmation</h5>
      
              <p style="word-wrap: break-word; width:100%;text-align:center; font-weight: 400">Are you sure?</p>
              <br><br>
              <div style="display: flex">
              <button onclick="handle(1)" class="waves-effect waves-light black btn-small" style="max-width: 120px; margin: auto; width: 40%">Yes</button>
              <button onclick="handle(2)" class="waves-effect waves-light black btn-small" style="max-width: 120px; margin: auto; width: 40%">No</button>
              </div>
           </div>
        

    </main>
</div>
    <!-- YOUR HTML GOES HERE AS WELL, BUT ADJUST GRID LAYOUT CSS FOR THE BODY ELEMENT TO MATCH THE NUMBER OF ROWS/COLUMNS ELEMENTS IN BODY -->
  
    <footer>
            <p>COPYRIGHTÂ© 2021 iSAVE, LTD. ALL RIGHTS RESERVED.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(elems);
        });

function show() {
  document.querySelector(".back").style.display = "block";
  document.querySelector(".mod").style.display = "block";
}

function handle() {
  document.querySelector(".back").style.display = "none";
  document.querySelector(".mod").style.display = "none";
}
  
function createAddDia(i) {
    let m = document.querySelector("#main");
    m.innerHTML += `
              <dialog id="dialog2">
                <p>Are you sure?</p>
                <br>
                <form method="dialog">
                    <button onclick="add(${i})" class="btn waves-effect waves-light black btn-small">Yes</button>
                    <button onclick="deleteDia()" class="btn waves-effect waves-light black btn-small">No</button>
                  </form>
      </dialog>`
    window.dialog2.showModal();
}

function createSubDia(i) {
    let m = document.querySelector("#main");
    m.innerHTML += `
              <dialog id="dialog2">
                <p>Are you sure?</p>
                <br>
                <form method="dialog">
                    <button onclick="reduce(${i})" class="btn waves-effect waves-light black btn-small">Yes</button>
                    <button onclick="deleteDia()" class="btn waves-effect waves-light black btn-small">No</button>
                  </form>
      </dialog>`
    window.dialog2.showModal();
    //console.log(m.childElementCount);
}

function deleteDia() {
    document.querySelector("#dialog2").remove();
    let m = document.querySelector("#main");
    //console.log(m.childElementCount);
}


        
function updateCount() {
    if (sessionStorage.getItem("count") === null){
      sessionStorage.setItem("count", 0);
    }
    let count = sessionStorage.getItem("count");
    

      document.querySelector("#cart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIcon" class="material-icons left">shopping_cart</i>(${count})</a>`;
      document.querySelector("#navCart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIconNav" class="material-icons left">shopping_cart</i>(${count})</a>`;
}
updateCount();

function draw() {

  
  let html = "";
  let html2 = "";
  let total = 0;
  let val = "";
  let k=0;
  let i;
  let sign='';

  let t = document.querySelector("#summary");
  let f = document.querySelector("#total");
  let b = document.querySelector("#bn");
  
  if (sessionStorage.getItem("cart") != null){

      let cart = JSON.parse(sessionStorage.getItem("cart"));
      for (i=0;i<cart.length;i++) {
        if (cart[i].price[k] === "-") {
                    k++;
                    sign=-1;
        }
        else sign = 1;
        if (cart[i].price[k] === "$") 
                    k++;
        while (cart[i].price[k] != ".") {
            val += (cart[i].price[k]);
            k++;
        }
      k=0;
      val = parseInt(val);
      console.log(typeof(val));
      total += cart[i].qty * val * sign;
      val = "";
      }

      if (total < 0) {
        sign = '-';
        total *= -1;
        }
      else sign = '';

  
    //console.log(typeof(cart[0].qty));
    let tmp = "None";
    
    
    for (i=0;i<cart.length;i++) {
        if (cart[i].ndevice)
          tmp = cart[i].ndevice
          

        html += `<tr>
                    <td>${i+1}</td>
                    <td class="nowrap">
                      <button onclick="showSub(${i})" class="adjust"><i class="material-icons">remove_circle</i></button>
                      <button class="qty">${cart[i].qty}</button>
                      <button onclick="showAdd(${i})" class="adjust"><i class="material-icons">add_circle</i></button>
                    </td>
                    <td>${cart[i].device} </td>
                    <td>${tmp}</td>
                    <td>${cart[i].storage}</td>
                    <td>${cart[i].color}</td>
                    <td>${cart[i].price}</td>
            </tr>`;
        tmp = "None";
    }
  }
    html2 = `<tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>Total:</td>
                    <td>${sign}$${total}.00</td>
            </tr>`

    if(total === 0)
     b.disabled = true;
    t.innerHTML = html;
    f.innerHTML = html2;
    b.style.visibility = "visible";

}
draw();

function showAdd (i) {
  document.querySelector("main").innerHTML +=  `<div class="back">
        </div>
        <div style="padding: 10px; flex-direction: column" class="mod">
              <h5 style="text-align: center">Notification</h5>   
              <br> 
              <p style="word-wrap: break-word; width:100%;text-align:center; font-weight: 400">Are you sure?</p>
              <br>
              <div style="display: flex">
              <button onclick="add(${i})" class="waves-effect waves-light black btn-small" style="max-width: 120px; margin: auto; width: 40%">Yes</button>
              <button onclick="discard()" class="waves-effect waves-light black btn-small" style="max-width: 120px; margin: auto; width: 40%">No</button>
              </div>
              
              </div>
           </div>`
}

function showSub (i) {
  document.querySelector("main").innerHTML +=  `<div class="back">
        </div>
        <div style="padding: 10px; flex-direction: column" class="mod">
              <h5 style="text-align: center">Notification</h5>   
              <br> 
              <p style="word-wrap: break-word; width:100%;text-align:center; font-weight: 400">Are you sure?</p>
              <br>
              <div style="display: flex">
              <button onclick="reduce(${i})" class="waves-effect waves-light black btn-small" style="max-width: 120px; margin: auto; width: 40%">Yes</button>
              <button onclick="discard()" class="waves-effect waves-light black btn-small" style="max-width: 120px; margin: auto; width: 40%">No</button>
              </div>
              
              </div>
           </div>`
}

function discard() {
  document.querySelector(".back").remove();
  document.querySelector(".mod").remove();
}

function add(i) {
discard();
  let e = JSON.parse(sessionStorage.getItem("cart"));
  e[i].qty += 1;
  sessionStorage.setItem("cart", JSON.stringify(e));
  let c = sessionStorage.getItem("count");
  c++;
  sessionStorage.setItem("count",c);
  draw();
  updateCount();
  //discard();
}

function reduce(i) {
  let e = JSON.parse(sessionStorage.getItem("cart"));
  if (e[i].qty > 1) 
    e[i].qty -= 1;
  else {
    e.splice(i,1);
    // if (cart.lenght === 0)
    //   sessionStorage.removeItem("cart");
  }
  sessionStorage.setItem("cart", JSON.stringify(e));
  let c = sessionStorage.getItem("count");
  c--;
  sessionStorage.setItem("count",c);
  draw();
  updateCount();
  discard();
}

function openForm() {
    window.open("<?= ScriptApp.getService().getUrl(); ?>?v=form", "_top");
}

    </script>
  </body>
</html>
