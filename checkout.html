<!DOCTYPE html>
<html>
  <head>
    <!-- HEADER AND FOOTER TEMPLATE (DO NOT EDIT - JUST COPY AND PASTE)-->
    <base target="_top">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <style>
      * {
          box-sizing: border-box;
      }

      body {
        //border: solid yellow;
        display: flex;
        flex-direction: column;
        //position: relative;
        justify-content: space-between;
        height: 100vh;
        //margin-bottom: 30px;
        //overflow-x: hidden;
      }

      footer {
        text-align: center;
        font-size: 0.85em;
        color: white;
        background-color: black;
        box-shadow: 0px 0 10px rgba(0, 0, 0, 0.7);
        margin-top: 30px;
        //position: relative;
        //height: 10%;
      }

      nav {
        height:100%
        position: sticky;
        top: 0;
      }

      nav ul li:hover {
        background-color: grey;
      }

      .brand-logo, .brand-logo img {
          
          height: 100%;
      }

      .nav-wrapper {
        height: 100%;
        background-color: black;
      }

      #cartIcon {
        position: relative;
        left: 10px;
      }

      #cartIconNav {
        position: relative;
        margin-right: 5px;
      }

      main {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;        
        //border: solid black;
       // position: relative;
        min-height: max-content;
        //height: 100%;
      }

      #head {
        //border: solid red;

      }

      h4 {
        margin-bottom: 30px;
      }

      td, th {
        text-align: center;
      }


      @media screen and (max-width: 600px) {
        td {
          font-size: 2.5vw;
        } 
      }

      .nowrap {
        white-space: nowrap;
      }      

      tfoot {
        font-weight: bold;
       font-size: 1.2em;
      }

      #bn {
        //margin-top: 50px;
        margin-left: auto;
        margin-right: auto;
        background-color: black;
        width: 40%;
      }

      @media screen and (min-width: 600px) {
        #bn {
          width: 20%;
        } 
      }

      table {
        position: relative;
        max-height: 100%;
        //border: solid red;
        overflow-y: auto;
        margin-bottom: 30px;
      }

      .qty:focus, .qty {
        border: none;
        background-color: transparent;
        //vertical-align: middle;
      }

      .adjust, .adjust:focus {
        border: none;
        background-color: transparent;
        font-size: 2em;
        vertical-align: middle;
        /* padding-bottom: 4px;
        padding-left: -2px;
        padding-right: -2px; */
        //width: 5px;
      }

      .adjust:active {
          color: gray;
      }
     

    //***YOUR CSS GOES HERE***//

    </style>
  </head>

  <body>
    <div id="sec">
    <header>
      <div class="navbar-fixed">
            <nav>
            <div class="nav-wrapper">
              <a href="<?= ScriptApp.getService().getUrl(); ?>?v=index" class="brand-logo"><img id="logo" 
              src="https://drive.google.com/uc?export=download&id=1nbkr2Z9Ulrwn6kNQuMK1cqkdcumEcryU"></a>
              <a href="" data-target="items" class="sidenav-trigger"><i class="material-icons">menu</i></a>
              <ul class="right hide-on-med-and-down">
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
                <li id="cart"></li>
              </ul>
            </div>
          </nav>
      </div>

          <ul class="sidenav" id="items">
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
            <li id="navCart"></li>
          </ul>
    </header>

    <!-- YOUR HTML GOES HERE, BUT ADJUST GRID LAYOUT CSS FOR THE BODY ELEMENT TO MATCH THE NUMBER OF ROWS/COLUMNS ELEMENTS IN BODY -->

    <main id="main">




    <h4 id="head" style="text-align:center;">Order Summary</h4>

    <table>
           <thead>
                <tr>
                   <th>#</th>
                   <th>Quantity</th>
                   <th>Desired Device</th>
                   <th>Traded Device</th>
                   <th>Storage</th>
                   <th>Colour</th>
                   <th>Price</th>
                </tr>
                </thead>
                  <tbody id="summary">
                                                
                  </tbody>
                  <tfoot id="total">

                  </tfoot>
           </table>
    <button id="bn" style="visibility: hidden" class="waves-effect waves-light black btn-small">Checkout</button>

    <dialog id="dg">
      <form method="dialog">
        <p>Are you sure?<p>
        <menu>
          <button name="rv" id="b" value="Yes">Yes</button>
          <button value="No">No</button>
        </menu>
      </form>
    <dialog>
        

    </main>
</div>
    <!-- YOUR HTML GOES HERE AS WELL, BUT ADJUST GRID LAYOUT CSS FOR THE BODY ELEMENT TO MATCH THE NUMBER OF ROWS/COLUMNS ELEMENTS IN BODY -->
  
    <footer>
            <p>COPYRIGHTÂ© 2021 iSAVE, LTD. ALL RIGHTS RESERVED.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(elems);
        });

  
function createAddDia(i) {
    let m = document.querySelector("#main");
    console.log(m.childElementCount);
    m.innerHTML += `
              <dialog id="dialog2">
                <p>Are you sure?</p>
                <br>
                <form method="dialog">
                    <button onclick="add(${i})" class="btn waves-effect waves-light black btn-small">Yes</button>
                    <button onclick="deleteDia()" class="btn waves-effect waves-light black btn-small">No</button>
                  </form>
      </dialog>`
    window.dialog2.showModal();
    console.log(m.childElementCount);
}

function createSubDia(i) {
    let m = document.querySelector("#main");
    console.log(m.childElementCount);
    m.innerHTML += `
              <dialog id="dialog2">
                <p>Are you sure?</p>
                <br>
                <form method="dialog">
                    <button onclick="reduce(${i})" class="btn waves-effect waves-light black btn-small">Yes</button>
                    <button onclick="deleteDia()" class="btn waves-effect waves-light black btn-small">No</button>
                  </form>
      </dialog>`
    window.dialog2.showModal();
    console.log(m.childElementCount);
}

function deleteDia() {
    document.querySelector("#dialog2").remove();
    let m = document.querySelector("#main");
    console.log(m.childElementCount);
}


        
function updateCount() {
    if (sessionStorage.getItem("count") === null){
      sessionStorage.setItem("count", 0);
    }
    let count = sessionStorage.getItem("count");
    

      document.querySelector("#cart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIcon" class="material-icons left">shopping_cart</i>(${count})</a>`;
      document.querySelector("#navCart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIconNav" class="material-icons left">shopping_cart</i>(${count})</a>`;
}
updateCount();

function draw() {

  let cart = JSON.parse(sessionStorage.getItem("cart"));
  let html = "";
  let html2 = "";
  let total = 0;
  let val = "";
  let k=0;
  let i;
  
      for (i=0;i<cart.length;i++) {
        while (cart[i].price[k] === "$") 
                    k++;
        while (cart[i].price[k] != ".") {
            val += (cart[i].price[k]);
            k++;
        }
      k=0;
      val = parseInt(val);
      total += cart[i].qty * val;
      val = "";
      }

  
    //console.log(typeof(cart[0].qty));
    let tmp = "None";
    let t = document.querySelector("#summary");
    let f = document.querySelector("#total");
    let b = document.querySelector("#bn");
    if(total === 0)
     b.disabled = true;
    for (i=0;i<cart.length;i++) {
        k=0;
        if (cart[i].ndevice)
          tmp = cart[i].ndevice

          // let num = "";
          // let sign = '';
        //   while (cart[i].price[k] === "$" || cart[i].price[k] === "-") 
        //             k++;
        // while (cart[i].price[k] != ".") {
        //     num += (cart[i].price[k]);
        //     k++;
        // }
        // num = parseInt(num);
        // if (num < 0) {
        //   sign = '-';
        //   num *= -1;
        // }

        html += `<tr>
                    <td>${i+1}</td>
                    <td class="nowrap">
                      <button onclick="createSubDia(${i})" class="adjust"><i class="material-icons">remove_circle</i></button>
                      <button class="qty">${cart[i].qty}</button>
                      <button onclick="createAddDia(${i})" class="adjust"><i class="material-icons">add_circle</i></button>
                    </td>
                    <td>${cart[i].device} </td>
                    <td>${tmp}</td>
                    <td>${cart[i].storage}</td>
                    <td>${cart[i].color}</td>
                    <td>${cart[i].price}.00</td>
            </tr>`;
        tmp = "None";
    }
    html2 = `<tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>Total:</td>
                    <td>$${total}.00</td>
            </tr>`

    t.innerHTML = html;
    f.innerHTML = html2;
    b.style.visibility = "visible";

}
draw();

function add(i) {

  let e = JSON.parse(sessionStorage.getItem("cart"));
  e[i].qty += 1;
  sessionStorage.setItem("cart", JSON.stringify(e));
  let c = sessionStorage.getItem("count");
  c++;
  sessionStorage.setItem("count",c);
  draw();
  updateCount();
  deleteDia()
}

function reduce(i) {
  let e = JSON.parse(sessionStorage.getItem("cart"));
  if (e[i].qty > 1) 
    e[i].qty -= 1;
  else {
    e.splice(i,1);
    // if (cart.lenght === 0)
    //   sessionStorage.removeItem("cart");
  }
  sessionStorage.setItem("cart", JSON.stringify(e));
  let c = sessionStorage.getItem("count");
  c--;
  sessionStorage.setItem("count",c);
  draw();
  updateCount();
  deleteDia()
}

    </script>
  </body>
</html>
