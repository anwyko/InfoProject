<!DOCTYPE html>
<html>
  <head>
    <!-- HEADER AND FOOTER TEMPLATE (DO NOT EDIT - JUST COPY AND PASTE)-->
    <base target="_top">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <style>
      * {
          box-sizing: border-box;
      }

      body {
        //border: solid yellow;
        display: flex;
        flex-direction: column;
        //position: relative;
        justify-content: space-between;
        height: 100vh;
        //margin-bottom: 30px;
      }

      footer {
        text-align: center;
        font-size: 0.85em;
        color: white;
        background-color: black;
        box-shadow: 0px 0 10px rgba(0, 0, 0, 0.7);
        margin-top: 30px;
        //position: relative;
        //height: 10%;
      }

      nav {
        height:100%
        position: sticky;
        top: 0;
      }

      nav ul li:hover {
        background-color: grey;
      }

      .brand-logo, .brand-logo img {
          
          height: 100%;
      }

      .nav-wrapper {
        height: 100%;
        background-color: black;
      }

      #cartIcon {
        position: relative;
        left: 10px;
      }

      #cartIconNav {
        position: relative;
        margin-right: 5px;
      }

      main {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;        
        //border: solid black;
       // position: relative;
        min-height: max-content;
        //height: 100%;
      }

      #head {
        //border: solid red;

      }

      h4 {
        margin-bottom: 30px;
      }

      td, th {
        text-align: center;
      }

      

      tfoot {
        font-weight: bold;
       font-size: 1.2em;
      }

      #bn {
        //margin-top: 50px;
        margin-left: auto;
        margin-right: auto;
        background-color: black;
        width: 40%;
      }

      @media screen and (min-width: 600px) {
        #bn {
          width: 20%;
        } 
      }

      table {
        position: relative;
        max-height: 100%;
        //border: solid red;
        overflow-y: auto;
        margin-bottom: 30px;
      }
     

    //***YOUR CSS GOES HERE***//

    </style>
  </head>

  <body>
    <div id="sec">
    <header>
            <nav>
            <div class="nav-wrapper">
              <a href="<?= ScriptApp.getService().getUrl(); ?>?v=index" class="brand-logo"><img id="logo" 
              src="https://drive.google.com/uc?export=download&id=1nbkr2Z9Ulrwn6kNQuMK1cqkdcumEcryU"></a>
              <a href="" data-target="items" class="sidenav-trigger"><i class="material-icons">menu</i></a>
              <ul class="right hide-on-med-and-down">
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
                <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
                <li id="cart"></li>
              </ul>
            </div>
          </nav>

          <ul class="sidenav" id="items">
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
            <li><a href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
            <li id="navCart"></li>
          </ul>
    </header>

    <!-- YOUR HTML GOES HERE, BUT ADJUST GRID LAYOUT CSS FOR THE BODY ELEMENT TO MATCH THE NUMBER OF ROWS/COLUMNS ELEMENTS IN BODY -->

    <main id="main">
    <h4 id="head" style="text-align:center;">Order Summary</h4>

    <table>
           <thead>
                <tr>
                   <th>#</th>
                   <th>Quantity</th>
                   <th>Desired Device</th>
                   <th>Traded Device</th>
                   <th>Storage</th>
                   <th>Colour</th>
                   <th>Price</th>
                </tr>
                </thead>
                  <tbody id="summary">
                                                
                  </tbody>
                  <tfoot id="total">

                  </tfoot>
           </table>
    <button id="bn" style="visibility: hidden" class="waves-effect waves-light black btn-small">Checkout</button>

    </main>
</div>
    <!-- YOUR HTML GOES HERE AS WELL, BUT ADJUST GRID LAYOUT CSS FOR THE BODY ELEMENT TO MATCH THE NUMBER OF ROWS/COLUMNS ELEMENTS IN BODY -->
  
    <footer>
            <p>COPYRIGHTÂ© 2021 iSAVE, LTD. ALL RIGHTS RESERVED.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(elems);
        });
        
      function updateCount() {
    if (sessionStorage.getItem("count") === null){
      sessionStorage.setItem("count", 0);
    }
    let count = sessionStorage.getItem("count");
    

      document.querySelector("#cart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIcon" class="material-icons left">shopping_cart</i>(${count})</a>`;
      document.querySelector("#navCart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIconNav" class="material-icons left">shopping_cart</i>(${count})</a>`;
}
updateCount();

function draw() {

  let cart = JSON.parse(sessionStorage.getItem("cart"));
  let html = "";
  let html2 = "";
  let total = 0;
  let val = "";
  let k=0;
  let i;
  if (cart.length != 0) {
  
      for (i=0;i<cart.length;i++) {
        while (cart[i].price[k] === "$") 
                    k++;
        while (cart[i].price[k] != ".") {
            val += (cart[i].price[k]);
            k++;
        }
      k=0;
      val = parseInt(val);
      console.log(typeof(val));
      total += cart[i].qty * val;
      val = "";
      }

  
    //console.log(typeof(cart[0].qty));
    let tmp = "None";
    let t = document.querySelector("#summary");
    let f = document.querySelector("#total");
    let b = document.querySelector("#bn");
    for (i=0;i<cart.length;i++) {
        if (cart[i].ndevice)
          tmp = cart[i].ndevice

        html += `<tr>
                    <td>${i}</td>
                    <td>${cart[i].qty}</td>
                    <td>${cart[i].device} </td>
                    <td>${tmp}</td>
                    <td>${cart[i].storage}</td>
                    <td>${cart[i].color}</td>
                    <td>${cart[i].price}</td>
            </tr>`;
        tmp = "None";
    }
    html2 = `<tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>Total:</td>
                    <td>$${total}.00</td>
            </tr>`

    t.innerHTML = html;
    f.innerHTML = html2;
    b.style.visibility = "visible";
  }
}
draw();



    </script>
  </body>
</html>
