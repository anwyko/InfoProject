
<!DOCTYPE html>
<html>
  <head>
    <!-- HEADER AND FOOTER TEMPLATE (DO NOT EDIT - JUST COPY AND PASTE)-->
    <base target="_top">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <style>
      * {
          box-sizing: border-box;
      }

      body {
        //border: solid red;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100vh;
      }

      nav {
        height:100%
        position: sticky;
        top: 0;
      }

      nav ul li:hover {
        background-color: grey;
      }

      .brand-logo, .brand-logo img {
          height: 100%;
      }

      .nav-wrapper {
        height: 100%;
        background-color: black;
      }

      #cartIcon {
        position: relative;
        left: 10px;
      }

      #cartIconNav {
        position: relative;
        margin-right: 5px;
      }

      main {
        display: flex;
        flex-direction: column;
      }

      #head {
        //border: solid red;
      }

      .items {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }

      .item {
        position: relative;
        padding: 20px;
        flex-basis: 33%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        margin-bottom: 50px;
      }

      @media screen and (min-width: 1000px) {
        .item {
          flex-basis: 20%;
        } 
      }

      article:hover button{
        visibility: visible;
      }

      .pic {
        width: 100%;
      }

      article:hover .pic {
        transition: 0.3s;
        filter: blur(2px);
      }

      article {
        position: relative;
      }

      .label {
        margin: auto;
        margin-top: 5px;
        margin-left: 0;
        margin-bottom: 5px;
      }

      .price {
        margin: auto;
        margin-top: 5px;
        margin-left: 0;
        margin-bottom: 10px;
        color: red;
      }

      .wrap {
        position: relative;
      }

      .specs {
        width: 100%;
        position: absolute;
        top: 46%;
        margin: auto;
        background-color: transparent;
        border: solid black;
        border-radius: 5px;
        color: white;
        visibility: hidden;
        z-index: 2;
      }

      .atc {
        background-color: black;
        border: solid black;
        border-radius: 5px;
        color: white;
        height: 2rem;
      }

      .specs:focus {
        background-color: black;
      }

      footer {
        text-align: center;
        font-size: 0.85em;
        background-color: black;
        color: white;
        box-shadow: 0px 0 5px rgba(0, 0, 0, 0.5);
      }

      #banner::before {
        background-image: url("https://drive.google.com/uc?export=download&id=1oj37E9Q4Vs6TuXnTHYnxcMzU8lBJkIkA");
        background-size: 100%;
        background-position: center top;
        background-repeat: no-repeat;
        //background-attachment: fixed;
        //min-height: 100vh;
        //min-width: 75vw;
        content: "";
        object-fit: cover;
        position: absolute;
        height: 100%;
        width: 100%;
        z-index: -2;
        opacity: 0.2;
        //top: 10px;
        margin: auto;        
      }

      @media screen and (max-width: 600px) {
        #banner::before {
          background-size: 150%;
        } 
      }

      #labeltop {
        font-size: 2rem;
        font-family: Impact, Charcoal, sans-serif;
        text-align: center;
        //position: static;
      }

      .inst {
        font-size: 1.1rem;
        font-weight: bold;
        //font-family: Impact, Charcoal, sans-serif;
        text-align: center;
      }

    </style>
  </head>

  <body>

    <header>
            <nav>
            <div class="nav-wrapper">
              <a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=index" class="brand-logo"><img id="logo" 
              src="https://drive.google.com/uc?export=download&id=1nbkr2Z9Ulrwn6kNQuMK1cqkdcumEcryU"></a>
              <a href="#" data-target="items" class="sidenav-trigger"><i class="material-icons">menu</i></a>
              <ul class="right hide-on-med-and-down">
                <li><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
                <li><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
                <li><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
                <li id="cart"></li>
              </ul>
            </div>
          </nav>

          <ul class="sidenav" id="items">
            <li><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=index">Home</a></li>
            <li><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">Estimator</a></li>
            <li><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=about">About</a></li>
            <li id="navCart"></li>
          </ul>
    </header>

    <main>

      
    <div id="banner" class="section">
                <p id="labeltop">Welcome to iSave!</p>
                <ul id="intro">
                    <li class="inst">Your one-stop-shop for the lastest iPhones</li>
                    <li class="inst">Click <span><a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=estimator">HERE</a></span> to trade in your used iPhone and save big! </li>
                </ul>
            </div>

    <div class="items">

<!-- ADJUST SPECS, INCREMENT FIRST 2 DIALOGS, UPDATE IMAGE, CHANGE DEVICE NAME, ADJUST STORAGES, ADJUST COLORS, INCREMENT ADD FUNCTION -->

      <article class="item">
            <div class="wrap">               
            <button  class="specs" onclick="window.dialog1.showModal();">View Specs</button>
            <dialog id="dialog1">
                <ul>
                  <li>Screen: Super Retina XDR OLED</li>
                  <li>Resolution: 1284 x 2778 pixels</li>
                  <li>Battery: Li-Ion 3687 mAh</li>
                  <li>Front Camera: 12 MP (Dual)</li>
                  <li>Back Camera: 12 MP (Quad)</li>
                  <li>CPU: Hexa-core (2x3.1 GHz Firestorm + 4x1.8 GHz Icestorm)</li>
                  <li>RAM: 3 GB</li>
                </ul>
            <form method="dialog">
                <button class="btn waves-effect waves-light black btn-small">Close</button>
              </form>
            </dialog>
            <img  class="pic" src="https://drive.google.com/uc?export=download&id=1Sxmgkwr8MigSjOldsnOie4C2ANzZZr9s"> 
            </div>
            <p style="font-weight: bold; font-size: 1.25em" class="label">iPhone 12 Pro Max</p>
            <select id="a" onchange="load()" class="browser-default">
        <option value="128gb">128gb</option>
        <option value="256gb">256gb</option>
        <option value="512gb">512gb</option>
      </select>
            <form action="#">
              <p>
                <label>
                  <input class="colors" name="color" value="Silver" type="radio" checked />
                  <span>Silver</span>
                </label>
              </p>
              <p>
                <label>
                  <input class="colors" name="color" value="Graphite" type="radio" />
                  <span>Graphite</span>
                </label>
              </p>
            </form>          
            <p style="font-weight: bold" class="price"></p>
            <button onclick="add(0)" class="btn waves-effect waves-light black btn-small">BUY</button>
      </article>



      
    </div>

    </main>

  
    <footer>
            <p>COPYRIGHTÂ© 2021 iSAVE, LTD. ALL RIGHTS RESERVED.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('.sidenav');
            var instances = M.Sidenav.init(elems);
        });

      document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('select');
    var instances = M.FormSelect.init(elems, options);
  });

function updateCount() {
    if (sessionStorage.getItem("count") === null){
      sessionStorage.setItem("count", 0);
    }
    let count = sessionStorage.getItem("count");
    

      document.querySelector("#cart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIcon" class="material-icons left">shopping_cart</i>(${count})</a>`;
      document.querySelector("#navCart").innerHTML = `<a onclick="unpersist()" href="<?= ScriptApp.getService().getUrl(); ?>?v=checkout">
      <i id="cartIconNav" class="material-icons left">shopping_cart</i>(${count})</a>`;
}
updateCount();


function add(i) {

    items = document.querySelectorAll(".item");
    let confirm = items[i].querySelectorAll(".btn");
    console.log(confirm[1].textContent);
    if (confirm[1].textContent != "CONFIRM?") 
      confirm[1].textContent = "CONFIRM?";
    else {
           let price = items[i].querySelector(".price").textContent;
          let t=0, j=0, k=0;
          if (price[0] != "$") t=1;
          let ndevice;
          let tmp = "";
          if (t === 1)
            ndevice = sessionStorage.getItem("device");
          if (t === 1) {
            while (price[k] != "$") 
                  k++;
            while (price[k] != " ") {
              tmp += (price[k]);
              j++; 
                k++;
                //console.log(tmp);
            }
            price = tmp;
            console.log(price);
          }
            
          let device = items[i].querySelector(".label").textContent;
          let rom = items[i].querySelector("select").value;
          
          let colors = items[i].querySelectorAll(".colors");
          let color;
          for (let j=0;j<colors.length;j++) {
            if (colors[j].checked) {
              color = colors[j].value;
              break;
            }
          }

          let found = 0;
          let c = sessionStorage.getItem("count");
          c++;
          sessionStorage.setItem("count",c);
          let entry;
          //console.log(t);
          if (t === 0)
            entry = {"type": "p", "qty": 1,"color": color,"device": device, "storage": rom, "price": price};
          else {entry = {"type": "t", "qty": 1,"color": color,"device": device, "ndevice": ndevice,"storage": rom, "price": price};
          //console.log(entry);
          }

          if (sessionStorage.getItem("cart") === null){
            let cart = [entry];
            sessionStorage.setItem("cart", JSON.stringify(cart));
          }
          else {
            let e = JSON.parse(sessionStorage.getItem("cart"));
            if (entry.type === "p") {
              //let f1 = e.filter(function(x)return (x.type === "p"));
              for (let i=0;i<e.length;i++){
                if (e[i].type === "p") {
                  if ((entry.device === e[i].device) && (entry.storage === e[i].storage) && (entry.color === e[i].color) && (entry.price === e[i].price)) {
                    e[i].qty += 1;
                    found = 1;
                  }
                }
              }
            }
                else {
                  for (let i=0;i<e.length;i++){
                      if ((entry.device === e[i].device) && (entry.ndevice === e[i].ndevice) && (entry.storage === e[i].storage) && (entry.color === e[i].color) && (entry.price === e[i].price)) {
                        e[i].qty += 1;
                        found = 1;
                      }
                }
                }
            
            if (found != 1)
              e.push(entry);
            sessionStorage.setItem("cart", JSON.stringify(e));
          }
          updateCount();
          confirm[1].textContent = "ADDED TO CART!";
      }
  }
//add();

function reduce(i, type) {

  let c = sessionStorage.getItem("count");
  c--;
      sessionStorage.setItem("count",c);
  let e = JSON.parse(sessionStorage.getItem("cart"));
      if (type === "p") {
          for (let i=0;i<e.length;i++){
            if ((entry.device === e[i].device) && (entry.storage === e[i].storage) && (entry.color === e[i].color) && (entry.price === e[i].price)) {
              if (e[i].qty > 1) 
                e[i].qty -= 1;
              else e.splice(i,1);
            }
          }
      }
      else {
        for (let i=0;i<e.length;i++){
            if ((entry.device === e[i].device) && (entry.ndevice === e[i].ndevice) && (entry.storage === e[i].storage) && (entry.color === e[i].color) && (entry.price === e[i].price)) {
              if (e[i].qty > 1) 
                e[i].qty -= 1;
              else e.splice(i,1);
            }
          }
      }
      
      sessionStorage.setItem("cart", JSON.stringify(e));
      updateCount();
}
//reduce();

function del(i) {
      let c = sessionStorage.getItem("count");
      c--;
      sessionStorage.setItem("count",c);
      let e = JSON.parse(sessionStorage.getItem("cart"));
      e.splice(i,1);
      sessionStorage.setItem("cart", JSON.stringify(e));
      updateCount();
}
//del();

function clr() {
  sessionStorage.clear();
  updateCount();
}
//clr();



function load() {
            google.script.run.withSuccessHandler(showOptions).loadOptions();
        }
function showOptions(list) {

      let est = sessionStorage.getItem("estimate");
      console.log(est);
      let dev = sessionStorage.getItem("device");
      items = document.querySelectorAll(".item");
      items.forEach(function(item){
        let device = item.querySelector(".label").textContent;
        let rom = item.querySelector("select").value;
        let price = item.querySelector(".price");
        for(let i=0;i<list.length;i++) {
          if (list[i][0] === `${device} ${rom}`) {
            if (sessionStorage.getItem("persist") === "true") {
              let diff = list[i][2] - est;
              price.textContent = `Only $${diff}.00 + your ${dev}!`;
            }
            else 
              price.textContent = `$${list[i][2]}.00`;
          }
        }
      })
}
load();
function unpersist() {
  sessionStorage.setItem("persist", false);
}

    </script>
  </body>
</html>
